<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      layout:decorate="~{layout}"> <!-- K·∫ø th·ª´a layout chung -->
<head>
    <meta charset="UTF-8">
    <title>B√°o c√°o th·ªëng k√™</title>
    <script src="https://cdn.tailwindcss.com"></script> <!-- S·ª≠ d·ª•ng TailwindCSS -->
</head>
<body class="bg-gray-100 text-gray-800"> <!-- Thi·∫øt l·∫≠p m√†u n·ªÅn v√† ch·ªØ -->

<!-- N·ªôi dung ch√≠nh ƒë∆∞·ª£c ƒë·∫∑t trong layout fragment "content" -->
<div layout:fragment="content" class="max-w-6xl mx-auto p-6 bg-white mt-8 rounded shadow">

    <h1 class="text-2xl font-bold text-blue-700 mb-6">üìä B√°o c√°o th·ªëng k√™</h1> <!-- Ti√™u ƒë·ªÅ -->

    <!-- Form l·ªçc b√°o c√°o -->
    <form method="post" th:action="@{/report/statistics}" th:object="${reportFilterRequest}"
          class="grid grid-cols-1 md:grid-cols-4 gap-4 mb-8">
        <!-- Tr∆∞·ªùng ch·ªçn t·ª´ ng√†y -->
        
      <div>
	    <label class="block font-medium mb-1">T·ª´ ng√†y:</label>
	    <input type="date"
	           th:field="*{fromDate}"
	           th:min="${#temporals.format(T(java.time.LocalDate).now().minusYears(1), 'yyyy-MM-dd')}"
	           th:max="${#temporals.format(T(java.time.LocalDate).now(), 'yyyy-MM-dd')}"
	           class="w-full border px-3 py-2 rounded"/>
	    <div th:if="${#fields.hasErrors('fromDate')}" th:errors="*{fromDate}" class="text-red-500 text-sm"></div>
	</div>

        <!-- Tr∆∞·ªùng ch·ªçn ƒë·∫øn ng√†y -->
        <div>
            <label class="block font-medium mb-1">ƒê·∫øn ng√†y:</label>
            <input type="date" th:field="*{toDate}" class="w-full border px-3 py-2 rounded"/>
            <div th:if="${#fields.hasErrors('toDate')}" th:errors="*{toDate}" class="text-red-500 text-sm"></div>
        </div>
        <!-- Tr∆∞·ªùng ch·ªçn lo·∫°i b√°o c√°o -->
        <div>
            <label class="block font-medium mb-1">Lo·∫°i b√°o c√°o:</label>
            <select th:field="*{category}" class="w-full border px-3 py-2 rounded">
                <option value="" disabled th:if="${category == null}">-- Ch·ªçn lo·∫°i --</option>
                <option th:each="t : ${types}" th:value="${t}" th:text="${t}" th:selected="${t == category}"></option>
            </select>
        </div>
        <!-- N√∫t xem b√°o c√°o -->
        <div class="flex items-end">
            <button type="submit"
                    class="w-full bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded">Xem
            </button>
        </div>
    </form>

    <!-- B·∫£ng k·∫øt qu·∫£ th·ªëng k√™ -->
    <div class="overflow-x-auto mb-8">
        <!-- N·∫øu lo·∫°i l√† th·ªëng k√™ nh√¢n vi√™n -->
        <th:block th:if="${type == T(com.viettridao.cafe.common.ReportType).EMPLOYEE_INFO}">
            <h2 class="text-xl font-semibold text-blue-800 mb-3">üíº Th·ªëng k√™ l∆∞∆°ng t·ª´ng nh√¢n vi√™n</h2>
            <table class="min-w-full border border-gray-300 bg-white text-center">
                <thead class="bg-gray-200">
                <tr>
                    <th class="py-2 px-4 border">üë§ Nh√¢n vi√™n</th>
                    <th class="py-2 px-4 border">üìÖ Ng√†y</th>
                    <th class="py-2 px-4 border text-purple-700">L∆∞∆°ng/ng√†y</th>
                </tr>
                </thead>
                <tbody>
                <!-- Duy·ªát danh s√°ch l∆∞∆°ng nh√¢n vi√™n -->
                <tr th:each="e : ${employeeSalaries}" class="hover:bg-gray-50">
                    <td class="border py-2 px-4" th:text="${e.fullName}"></td>
                    <td class="border py-2 px-4" th:text="${#temporals.format(e.date, 'dd/MM/yyyy')}"></td>
                    <td class="border py-2 px-4 text-purple-700"
                        th:text="${#numbers.formatDecimal(e.dailySalary, 0, 'COMMA', 0, 'POINT')} + ' ƒë'"></td>
                </tr>
                </tbody>
            </table>
        </th:block>

        <!-- Ng∆∞·ª£c l·∫°i: hi·ªÉn th·ªã b√°o c√°o thu chi -->
        <th:block th:unless="${type == T(com.viettridao.cafe.common.ReportType).EMPLOYEE_INFO}">
            <table class="min-w-full border border-gray-300 bg-white text-center">
                <thead class="bg-gray-200">
                <tr>
                    <th class="py-2 px-4 border">üìÖ Ng√†y</th>
                    <th class="py-2 px-4 border text-green-700">Thu</th>
                    <th class="py-2 px-4 border text-red-700">Chi</th>
                </tr>
                </thead>
                <tbody>
                <!-- Duy·ªát danh s√°ch b√°o c√°o -->
                <tr th:each="report : ${reports}" class="hover:bg-gray-50">
                    <td class="border py-2 px-4"
                        th:text="${report.date != null ? #temporals.format(report.date, 'dd/MM/yyyy') : ''}"></td>
                    <td class="border py-2 px-4 text-green-600"
                        th:text="${report.revenue != null ? #numbers.formatDecimal(report.revenue, 0, 'COMMA', 0, 'POINT') + ' ƒë' : '0 ƒë'}"></td>
                    <td class="border py-2 px-4 text-red-600"
                        th:text="${report.expense != null ? #numbers.formatDecimal(report.expense, 0, 'COMMA', 0, 'POINT') + ' ƒë' : '0 ƒë'}"></td>
                </tr>
                </tbody>
              <tfoot>
				<tr class="bg-gray-100 font-semibold">
				    <td class="py-2 px-4 text-right">T·ªïng:</td>
				    <td class="py-2 px-4 text-green-700"
				        th:text="${totalRevenue != null ? #numbers.formatDecimal(totalRevenue, 0, 'COMMA', 0, 'POINT') + ' ƒë' : '0 ƒë'}"></td>
				    <td class="py-2 px-4 text-red-700"
				        th:text="${totalExpense != null ? #numbers.formatDecimal(totalExpense, 0, 'COMMA', 0, 'POINT') + ' ƒë' : '0 ƒë'}"></td>
				</tr>
				</tfoot>

            </table>
        </th:block>
    </div>

    <!-- Khu v·ª±c xu·∫•t b√°o c√°o -->
    <div class="mb-8">
        <h2 class="text-xl font-semibold mb-2">üì§ Xu·∫•t b√°o c√°o</h2>
        <form method="get" th:action="@{/report/export}" class="flex flex-col md:flex-row items-center gap-4">
            <!-- Truy·ªÅn c√°c tham s·ªë l·ªçc d·∫°ng ·∫©n -->
            <input type="hidden" name="from" th:value="${from}"/>
            <input type="hidden" name="to" th:value="${to}"/>
            <input type="hidden" name="type" th:value="${type}"/>
            <!-- Ch·ªçn ƒë·ªãnh d·∫°ng file -->
            <div class="flex gap-3 items-center">
                <label class="font-medium">ƒê·ªãnh d·∫°ng:</label>
                <label><input type="radio" name="format" value="TXT" checked class="mr-1">.txt</label>
                <label><input type="radio" name="format" value="XLS" class="ml-3 mr-1">.xls</label>
                <label><input type="radio" name="format" value="SQL" class="ml-3 mr-1">.sql</label>
                <label><input type="radio" name="format" value="PDF" class="ml-3 mr-1">.pdf</label> <!-- ‚úÖ -->
            </div>
            <!-- N√∫t xu·∫•t file -->
            <button type="submit" class="bg-green-600 hover:bg-green-700 text-white px-4 py-2 rounded">
                üíæ Xu·∫•t file
            </button>
        </form>
    </div>

    <!-- Khu v·ª±c in b√°o c√°o -->
    <div>
        <h2 class="text-xl font-semibold mb-2">üñ®Ô∏è In b√°o c√°o</h2>
        <form method="post" th:action="@{/report/print}" class="grid grid-cols-1 md:grid-cols-4 gap-4 items-end">
            <!-- Ch·ªçn kh·ªï gi·∫•y -->
            <div>
                <label class="block font-medium mb-1">Kh·ªï gi·∫•y:</label>
                <select name="paperSize" required class="w-full border px-3 py-2 rounded">
                    <option value="A4">A4</option>
                    <option value="A5">A5</option>
                    <option value="Letter">Letter</option>
                </select>
            </div>
            <!-- Ch·ªçn m√°y in -->
            <div>
                <label class="block font-medium mb-1">M√°y in:</label>
                <select name="printerName" required class="w-full border px-3 py-2 rounded">
                    <option value="Printer1">Printer1</option>
                    <option value="Printer2">Printer2</option>
                </select>
            </div>
            <!-- Nh·∫≠p s·ªë l∆∞·ª£ng b·∫£n in -->
            <div>
                <label class="block font-medium mb-1">S·ªë l∆∞·ª£ng:</label>
                <input type="number" name="copies" min="1" value="1" required
                       class="w-full border px-3 py-2 rounded"/>
            </div>
            <!-- N√∫t in -->
            <div>
                <button type="submit" class="w-full bg-indigo-600 hover:bg-indigo-700 text-white px-4 py-2 rounded">
                    üñ®Ô∏è In
                </button>
            </div>
        </form>
    </div>

</div>
</body>
</html>
